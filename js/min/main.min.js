jQuery(function(a){function e(a){return value=parseInt(a),value>=0&&10>value?"0"+value.toString():a}function r(){p=a.payment.cardType(a(this).val()),a(".cards .sprite").removeClass("active"),a(this).parent().parent().removeClass("error"),p&&a(".cards").find("."+p).addClass("active"),l=a(".cc-number").val(),o()}function t(){c=a.payment.validateCardExpiry(a(".cc-exp").payment("cardExpiryVal")),o()}function n(){c=a.payment.validateCardExpiry(a(".cc-exp").payment("cardExpiryVal")),a(this).parent().parent().removeClass("error"),c||a(this).parent().parent().addClass("error"),o()}function s(){if(d){switch(d){case"card_type":case"card_number":a("#PaylerCardNum").focus().parent().parent().addClass("error");break;case"expired_month":case"expired_year":a("#PaylerExpired").focus().parent().parent().addClass("error")}a(".payler-error-popup").removeClass("hide").find("div").text(u)}}function o(){return p&&i&&c&&l?(a("#PaylerPostButton").addClass("active"),!0):(a("#PaylerPostButton").removeClass("active"),!1)}var p,c,i,l,d=a("#error_param").attr("data-error-param"),u=a("#error_param").attr("data-error-value");a("input").on("focus",function(){a(".payler-action-button").addClass("static")}),a("input").on("blur",function(){a(".payler-action-button").removeClass("static")}),a("#PaylerCardNum").payment("formatCardNumber"),a(".cc-exp").payment("formatCardExpiry"),a(".cc-cvc").payment("formatCardCVC"),a("#PaylerCardNum").val(a.payment.formatCardNumber(window.params_card.card_number)),a("#PaylerCardNum").each(r);var m=window.params_card.expired_month,y=window.params_card.expired_year;""!=m&&""!=y&&(a("#PaylerExpired").val(e(m)+" / "+e(y)),a("#PaylerExpired").each(t),a("#PaylerExpired").each(n));var v=window.params_card.card_holder;"NONAME"!=v&&a("#PaylerCardholder").val(v),a(".trigger-help").on("focus",function(){"amex"==p?(a(".popup4").css("display","none"),a(".popup5").css("display","block")):(a(".popup4").css("display","block"),a(".popup5").css("display","none")),a(this).siblings(".help-popup").addClass("show")}),a(".trigger-help").on("blur",function(){a(this).siblings(".help-popup").removeClass("show")}),a(".payler-error-popup .close").on("click",function(){a(this).parent().addClass("hide")}),a("#PaylerCardNum").on("keypress change blur",r),a("#PaylerCardNum").on("paste",function(e){setTimeout(function(){p=a.payment.cardType(a(e.currentTarget).val()),a(".cards .sprite").removeClass("active"),a(this).parent().parent().removeClass("error"),p&&a(".cards").find("."+p).addClass("active"),l=a(".cc-number").val(),o()},0)}),a("#PaylerExpired").on("keyup change",t),a("#PaylerExpired").on("blur",n),a("#PaylerCardholder").mask("AAAAAAAAAAAAAAAAAAAAAAAAAA"),a("#PaylerCode").on("keyup change",function(){i=a.payment.validateCardCVC(a(".cc-cvc").val(),p),o()}),a("#PaylerCode").on("blur",function(){i=a.payment.validateCardCVC(a(".cc-cvc").val(),p),a(this).parent().parent().removeClass("error"),i||a(this).parent().parent().addClass("error"),o()}),a("#PaylerPostButton").on("click keypress",function(e){if(p&&c&&i){l=a(".cc-number").val(),a('[name="card_number"]').val(l.replace(/\s/g,"")),a('[name="expired_month"]').val(a(".cc-exp").payment("cardExpiryVal").month),a('[name="expired_year"]').val(a(".cc-exp").payment("cardExpiryVal").year%100);var r=a("#PaylerCardholder").val();a('[name="card_holder"]').val(r.toUpperCase()),a("form").submit()}i||(a("#PaylerCode").focus(),e.preventDefault()),c||(a("#PaylerExpired").focus(),e.preventDefault()),p||(a("#PaylerCardNum").focus(),e.preventDefault()),e.preventDefault()}),a("form").on("submit",function(){a("#PaylerPostButton").removeClass("active").bind("click keypress",function(e){a(e).preventDefault()})}),s(),a("[data-popup]").on("click",function(){var e="#"+a(this).attr("data-popup");a(e).css("display","block"),setTimeout(function(){a(e).addClass("visible")},100)}),a("[data-dismiss]").on("click",function(){var e="#"+a(this).attr("data-dismiss");a(e).removeClass("visible"),setTimeout(function(){a(e).css("display","none")},101)})});